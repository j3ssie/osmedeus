{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/bytedance/Desktop/external/osmedeus-dashboard/app/api/mock/api/workflows/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport yaml from \"js-yaml\";\n\nexport const dynamic = \"force-static\";\n\nfunction normalizeTags(raw: unknown): string[] {\n  if (Array.isArray(raw)) {\n    return raw\n      .filter((t): t is string => typeof t === \"string\")\n      .map((t) => t.trim())\n      .filter(Boolean);\n  }\n  if (typeof raw === \"string\") {\n    return raw\n      .split(\",\")\n      .map((t) => t.trim())\n      .filter(Boolean);\n  }\n  return [];\n}\n\nfunction listYamlFiles(rootDir: string, relDir = \"\"): string[] {\n  const fullDir = path.join(rootDir, relDir);\n  const entries = fs.readdirSync(fullDir, { withFileTypes: true });\n  const out: string[] = [];\n\n  for (const e of entries) {\n    if (e.isDirectory()) {\n      out.push(...listYamlFiles(rootDir, path.join(relDir, e.name)));\n      continue;\n    }\n    if (e.isFile() && e.name.endsWith(\".yaml\")) {\n      out.push(path.join(relDir, e.name));\n    }\n  }\n\n  return out;\n}\n\nexport async function GET() {\n  const offset = 0;\n  const limit = 50;\n\n  const dir = path.join(process.cwd(), \"mock-workflows\");\n  let relFiles: string[] = [];\n  try {\n    relFiles = listYamlFiles(dir);\n  } catch {\n    relFiles = [];\n  }\n\n  const items = relFiles\n    .map((rel) => {\n      const full = path.join(dir, rel);\n      let doc: any = {};\n      try {\n        const content = fs.readFileSync(full, \"utf-8\");\n        doc = yaml.load(content) || {};\n      } catch {\n        doc = {};\n      }\n\n      const fallbackId = path.basename(rel, \".yaml\");\n      const name = typeof doc?.name === \"string\" && doc.name.trim() ? doc.name.trim() : fallbackId;\n      const wfKind = (doc?.kind as string) === \"flow\" ? \"flow\" : \"module\";\n      const description = (doc?.description as string) || `Mock workflow from ${rel}`;\n      const steps = Array.isArray(doc?.steps) ? doc.steps : [];\n      const modules = Array.isArray(doc?.modules) ? doc.modules : [];\n      const rawTags = normalizeTags(doc?.tags);\n      const tagSet = new Set(rawTags);\n      tagSet.add(\"mock-data\");\n      const tags = Array.from(tagSet);\n      const params = Array.isArray(doc?.params) ? doc.params : [];\n      const required_params = params.filter((p: any) => p?.required).map((p: any) => p?.name ?? \"\");\n\n      return {\n        name,\n        kind: wfKind,\n        description,\n        tags,\n        file_path: `/mock-workflows/${rel.replace(/\\\\/g, \"/\")}`,\n        params,\n        required_params,\n        step_count: steps.length,\n        module_count: modules.length,\n        checksum: \"\",\n        indexed_at: new Date().toISOString(),\n      };\n    });\n\n  const uniqueByName = new Map<string, any>();\n  items.forEach((wf) => {\n    const key = String(wf.name || \"\").trim();\n    if (!key) return;\n    if (!uniqueByName.has(key)) uniqueByName.set(key, wf);\n  });\n  const uniqueItems = Array.from(uniqueByName.values());\n\n  const sliced = uniqueItems.slice(Math.max(0, offset), Math.max(0, offset) + Math.max(0, limit));\n\n  return NextResponse.json({\n    data: sliced,\n    pagination: {\n      total: uniqueItems.length,\n      offset,\n      limit,\n    },\n  });\n}\n"],"names":[],"mappings":"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"}}]
}